/*! jQuery Fancytree Plugin - v2.0.0pre - 2013-05-04
* https://github.com/mar10/fancytree
* Copyright (c) 2013 Martin Wendt; Licensed MIT */(function(e){"use strict";function t(t){t=t||"",e.error("Not implemented: "+t)}function n(t,n){n=": "+n||"",t||e.error("Assertion failed"+n)}function r(e,t,n){var r=t[e],i=n[e];return function(){try{return t._super=function(){return r.apply(t,arguments)},i.apply(t,arguments)}finally{t._super=null}}}function i(t,n,i,o){e.ui.fancytree.debug("_subclassObject",n,i,o);for(var a in i)"function"==typeof i[a]?"function"==typeof t[a]?t[a]=r(a,t,i):"_"===a.charAt(0)?t[o][a]=e.proxy(i[a],t):e.error("Could not override tree."+a+". Use prefix '_' to create tree."+o+"._"+a):"options"!==a&&(t[o][a]=n[a])}function o(t,n){return void 0===t?e.Deferred(function(){this.resolve()}).promise():e.Deferred(function(){this.resolveWith(t,n)}).promise()}function a(t,n){return void 0===t?e.Deferred(function(){this.reject()}).promise():e.Deferred(function(){this.rejectWith(t,n)}).promise()}function s(e,t){return function(){e.resolveWith(t)}}function d(e){return e=e.toLowerCase(),function(t){return t.title.toLowerCase().indexOf(e)>=0}}function l(t,r){var i,o,a,s;for(this.parent=t,this.tree=t.tree,this.ul=null,this.li=null,this.isStatusNode=!1,this.data={},i=0,o=v.length;o>i;i++)a=v[i],this[a]=r[a];r.data&&e.extend(this.data,r.data);for(a in r)g[a]||e.isFunction(r[a])||y[a]||(this.data[a]=r[a]);null==this.key&&(this.key="_"+m._nextNodeKey++),r.active&&(n(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),this.children=null,s=r.children,s&&s.length&&this._setChildren(s)}function c(t){this.widget=t,this.$div=t.element,this.options=t.options,this._id=e.ui.fancytree._nextId++,this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this.lastSelectedNode=null,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var n,r={tree:this};this.rootNode=new l(r,{title:"root",key:"root_"+this._id,children:null}),this.rootNode.parent=null,n=e("<ul>",{"class":"ui-fancytree fancytree-container"}).appendTo(this.$div),this.$container=n,this.rootNode.ul=n[0],this.options.tabbable&&this.$container.attr("tabindex","0"),this.options.aria&&this.$container.attr("role","tree").attr("aria-multiselectable",!0)}function u(e,t){var n=window.console?window.console[e]:null;if(n)if(n.apply)n.apply(window.console,t);else{for(var r="",i=0;t.length>i;i++)r+=t[i];n(r)}}if(e.ui.fancytree&&e.ui.fancytree.version)return e.ui.fancytree.warn("Fancytree: ignored duplicate include"),void 0;var h,f="active expanded focus folder lazy selected".split(" "),p={};for(h=0;f.length>h;h++)p[f[h]]=!0;var v="expanded extraClasses folder key lazy selected title tooltip".split(" "),g={};for(h=0;v.length>h;h++)g[v[h]]=!0;var y={active:!0,children:!0,data:!0,focus:!0};l.prototype={_findDirectChild:function(e){var t=this.children;if(t)if("string"==typeof e){for(var n=0,r=t.length;r>n;n++)if(t[n].key===e)return t[n]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){n(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var t=0,r=e.length;r>t;t++)this.children.push(new l(this,e[t]))},addChildren:function(t,r){var i=null;if(e.isPlainObject(t)&&(t=[t]),this.children||(this.children=[]),void 0===r)for(var o=0,a=t.length;a>o;o++)0===o?(i=new l(this,t[o]),this.children.push(i)):this.children.push(new l(this,t[o]));else n(!r,"not implemented"),r=this._findDirectChild(r);return(!this.parent||this.parent.ul)&&this.render(),i},applyPatch:function(t){if(null===t)return this.remove(),o(this);var n,r={children:!0,expanded:!0,parent:!0};for(n in t){var i=t[n];r[n]||e.isFunction(i)||(g[n]?this[n]=i:this.data[n]=i)}t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus());var a;return a=t.hasOwnProperty("expanded")?this.setExpanded(t.expanded):o(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},countChildren:function(e){var t,n,r,i=this.children;if(!i)return 0;if(r=i.length,e!==!1)for(t=0,n=r;n>t;t++)r+=i[t].countChildren();return r},debug:function(){Array.prototype.unshift.call(arguments,""+this),m.debug.apply(this,arguments)},discard:function(){return this.lazy&&e.isArray(this.children)?(this.removeChildren(),this.setExpanded(!1)):void 0},findAll:function(t){t=e.isFunction(t)?t:d(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=e.isFunction(t)?t:d(t);var n=null;return this.visit(function(e){return t(e)?(n=e,!1):void 0}),n},fromDict:function(t){for(var n in t)g[n]?this[n]=t[n]:"data"===n?e.extend(this.data,t.data):e.isFunction(t[n])||y[n]||(this.data[n]=t[n]);t.children?(this.removeChildren(),this.addChildren(t.children)):this.renderTitle()},getChildren:function(){return void 0===this.hasChildren()?void 0:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return e.inArray(this,this.parent.children)},getIndexHier:function(t){t=t||".";var n=[];return e.each(this.getParentList(!1,!0),function(e,t){n.push(t.getIndex()+1)}),n.join(t)},getKeyPath:function(e){var t=[],n=this.tree.options.keyPathSeparator;return this.visitParents(function(e){e.parent&&t.unshift(e.key)},!e),n+t.join(n)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent)for(var e=this.parent.children,t=0,n=e.length-1;n>t;t++)if(e[t]===this)return e[t+1];return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],r=t?this:this.parent;r;)(e||r.parent)&&n.unshift(r),r=r.parent;return n},getPrevSibling:function(){if(this.parent)for(var e=this.parent.children,t=1,n=e.length;n>t;t++)if(e[t]===this)return e[t-1];return null},hasChildren:function(){return this.lazy?null===this.children||void 0===this.children?void 0:0===this.children.length?!1:1===this.children.length&&this.children[0].isStatusNode?void 0:!0:!!this.children},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},isActive:function(){return this.tree.activeNode===this},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e||e.tree!==this.tree)return!1;for(var t=this.parent;t;){if(t===e)return!0;t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoading:function(){t()},isRoot:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isVisible:function(){for(var e=this.getParentList(!1,!1),t=0,n=e.length;n>t;t++)if(!e[t].expanded)return!1;return!0},makeVisible:function(){for(var e=this.getParentList(!1,!1),t=0,n=e.length;n>t;t++)e[t].setExpanded(!0)},move:function(t,n){(void 0===n||"over"===n)&&(n="child");var r,i=this.parent,o="child"===n?t:t.parent;if(this!==t){if(!this.parent)throw"Cannot move system root";if(o.isDescendantOf(this))throw"Cannot move a node to it's own descendant";if(1===this.parent.children.length)this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1;else{if(r=e.inArray(this,this.parent.children),0>r)throw"Internal error";this.parent.children.splice(r,1)}if(this.parent=o,o.hasChildren())switch(n){case"child":o.children.push(this);break;case"before":if(r=e.inArray(t,o.children),0>r)throw"Internal error";o.children.splice(r,0,this);break;case"after":if(r=e.inArray(t,o.children),0>r)throw"Internal error";o.children.splice(r+1,0,this);break;default:throw"Invalid mode "+n}else o.children=[this];if(this.tree!==t.tree)throw"Cross-tree move is not yet implemented.";i.isDescendantOf(o)||i.render(),o.isDescendantOf(i)||o===i||o.render()}},lazyLoad:function(t){t?this.discard():n(!e.isArray(this.children));var r=this.tree._triggerNodeEvent("lazyload",this);return n("boolean"!=typeof r,"lazyload event must return source in data.result"),this.tree._callHook("nodeLoadChildren",this,r)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},scheduleAction:function(e,t){this.tree.timer&&clearTimeout(this.tree.timer),this.tree.timer=null;var n=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger expand"),n.setExpanded(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger activate"),n.setActive(!0)},t);break;default:throw"Invalid mode "+e}},scrollIntoView:function(t,n){t=t===!0?{duration:200,queue:!1}:t;var r=new e.Deferred,i=e(this.span).position().top,o=e(this.span).height(),a=this.tree.$container,s=a.height(),d=a[0].scrollTop,l=null;if(0>i)l=d+i;else if(i+o>s&&(l=d+i-s+o,n)){var c=n?e(n.span).position().top:0;i-c>s&&(l=d+i)}return null!==l?t?a.animate({scrollTop:l},t):(a[0].scrollTop=l,r.resolveWith(this)):r.resolveWith(this),r.promise()},setActive:function(e){return this.tree._callHook("nodeSetActive",this,e)},setExpanded:function(e){return this.tree._callHook("nodeSetExpanded",this,e)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e){return this.tree._callHook("nodeSetSelected",this,e)},setTitle:function(e){this.title=e,this.renderTitle()},sortChildren:function(e,t){var n=this.children;if(n){if(e=e||function(e,t){var n=e.title.toLowerCase(),r=t.title.toLowerCase();return n===r?0:n>r?1:-1},n.sort(e),t)for(var r=0,i=n.length;i>r;r++)n[r].children&&n[r].sortChildren(e,"$norender$");"$norender$"!==t&&this.render()}},toDict:function(t,n){var r={},i=this;if(e.each(v,function(e,t){(i[t]||i[t]===!1)&&(r[t]=i[t])}),e.isEmptyObject(this.data)||(r.data=e.extend({},this.data),e.isEmptyObject(r.data)&&delete r.data),n&&n(r),t&&this.hasChildren()){r.children=[];for(var o=0,a=this.children.length;a>o;o++)r.children.push(this.children[o].toDict(!0,n))}return r},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},visit:function(e,t){var n=!0,r=this.children;if(t===!0&&(n=e(this),n===!1||"skip"===n))return n;if(r)for(var i=0,o=r.length;o>i&&(n=r[i].visit(e,!0),n!==!1);i++);return n},visitParents:function(e,t){if(t&&e(this)===!1)return!1;for(var n=this.parent;n;){if(e(n)===!1)return!1;n=n.parent}return!0}},c.prototype={_makeHookContext:function(t,n){if(void 0!==t.node)return n&&t.orgEvent!==n&&e.error("invalid args"),t;if(t.tree){var r=t.tree;return{node:t,tree:r,widget:r.widget,options:r.widget.options,orgEvent:n}}return t.widget?{node:null,tree:t,widget:t.widget,options:t.widget.options,orgEvent:n}:(e.error("invalid args"),void 0)},_callHook:function(t,n){var r=this._makeHookContext(n),i=this[t],o=Array.prototype.slice.call(arguments,2);return e.isFunction(i)||e.error("_callHook('"+t+"') is not a function"),o.unshift(r),i.apply(this,o)},activateKey:function(e){var t=this.getNodeByKey(e);return t?t.setActive():this.activeNode&&this.activeNode.setActive(!1),t},applyPatch:function(t){for(var r,i,o,a,d=t.length,l=[],c=0;d>c;c++)if(r=t[c],n(2===r.length,"patchList must be an array of length-2-arrays"),i=r[0],o=r[1],a=null===i?this.rootNode:this.getNodeByKey(i)){var u=new e.Deferred;l.push(u),a.applyPatch(o).always(s(u,a))}else this.warn("could not find node with key '"+i+"'");return e.when.apply(e,l).promise()},count:function(){return this.rootNode.countChildren()},debug:function(){Array.prototype.unshift.call(arguments,""+this),m.debug.apply(this,arguments)},generateFormElements:function(t,n){var r=t!==!1?"ft_"+this._id:t,i=n!==!1?"ft_"+this._id+"_active":n,o="fancytree_result_"+this._id,a=this.$container.find("div#"+o);if(a.length?a.empty():a=e("<div>",{id:o}).hide().appendTo(this.$container),r){var s=this.getSelectedNodes(3===this.options.selectMode);e.each(s,function(t,n){a.append(e("<input>",{type:"checkbox",name:r,value:n.key,checked:!0}))})}i&&this.activeNode&&a.append(e("<input>",{type:"radio",name:i,value:this.activeNode.key,checked:!0}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getNodeByKey:function(e,t){if(!t){var n=document.getElementById(this.options.idPrefix+e);if(n)return n.ftnode?n.ftnode:null}var r=null;return t=t||this.rootNode,t.visit(function(t){return t.key===e?(r=t,!1):void 0},!0),r},getSelectedNodes:function(e){var t=[];return this.rootNode.visit(function(n){return n.selected&&(t.push(n),e===!0)?"skip":void 0}),t},hasFocus:function(){return m.focusTree===this},info:function(){Array.prototype.unshift.call(arguments,""+this),m.info.apply(this,arguments)},loadKeyPath:function(t,n,r){function i(e,t,r){n.call(h,t,"loading"),t.lazyLoad().done(function(){h.loadKeyPath.call(h,f[e],n,t).always(s(r,h))}).fail(function(){h.warn("loadKeyPath: error loading: "+e+" (parent: "+c+")"),n.call(h,t,"error"),r.reject()})}var o,a,d,l,c=r||this.rootNode,u=this.options.keyPathSeparator,h=this;e.isArray(t)||(t=[t]);for(var f={},p=0;t.length>p;p++)for(o=t[p],o.charAt(0)===u&&(o=o.substr(1)),l=o.split(u);l.length;){if(a=l.shift(),d=c._findDirectChild(a),!d){this.warn("loadKeyPath: key not found: "+a+" (parent: "+c+")"),n.call(this,a,"error");break}if(0===l.length){n.call(this,d,"ok");break}if(d.lazy&&void 0===d.hasChildren()){n.call(this,d,"loaded"),f[a]?f[a].push(l.join(u)):f[a]=[l.join(u)];break}n.call(this,d,"loaded"),c=d}var v=[];for(a in f){d=c._findDirectChild(a);var g=new e.Deferred;v.push(g),i(a,d,g)}return e.when.apply(e,v).promise()},nodeClick:function(e){var t=e.orgEvent,n=e.targetType,r=e.node;if("expander"===n)this._callHook("nodeToggleExpanded",e);else if("checkbox"===n)this._callHook("nodeToggleSelected",e),this._callHook("nodeSetFocus",e,!0);else{var i=!1,o=!0;if(r.folder)switch(e.options.clickFolderMode){case 2:i=!0,o=!1;break;case 3:o=!0,i=!0}o&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),i&&this._callHook("nodeToggleExpanded",e)}"a"===t.target.localName&&"fancytree-title"===t.target.className&&t.preventDefault()},nodeCollapseSiblings:function(e){var t=e.node;if(t.parent)for(var n=t.parent.children,r=0,i=n.length;i>r;r++)n[r]!==t&&n[r].expanded&&this._callHook("nodeSetExpanded",n[r],!1)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.orgEvent.preventDefault()},nodeKeydown:function(t){function n(e){return e?(e.makeVisible(),r.ctrlKey||!a.autoActivate?e.setFocus():e.setActive()):void 0}var r=t.orgEvent,i=t.node,o=t.tree,a=t.options,s=!0,d=e.ui.keyCode,l=null;switch(i.debug("ftnode.nodeKeydown("+r.type+"): ftnode:"+this+", charCode:"+r.charCode+", keyCode: "+r.keyCode+", which: "+r.which),r.which){case d.NUMPAD_ADD:case 187:o.nodeSetExpanded(t,!0);break;case d.NUMPAD_SUBTRACT:case 189:o.nodeSetExpanded(t,!1);break;case d.SPACE:a.checkbox?o.nodeToggleSelected(t):o.nodeSetActive(t,!0);break;case d.ENTER:o.nodeSetActive(t,!0);break;case d.BACKSPACE:n(i.parent);break;case d.LEFT:i.expanded?(o.nodeSetExpanded(t,!1),n(i)):i.parent&&i.parent.parent&&n(i.parent);break;case d.RIGHT:i.expanded||!i.children&&!i.lazy?i.children&&n(i.children[0]):(o.nodeSetExpanded(t,!0),n(i));break;case d.UP:for(l=i.getPrevSibling();l&&l.expanded&&l.children;)l=l.children[l.children.length-1];!l&&i.parent&&i.parent.parent&&(l=i.parent),n(l);break;case d.DOWN:if(i.expanded&&i.children)l=i.children[0];else for(var c=i.getParentList(!1,!0),u=c.length-1;u>=0&&!(l=c[u].getNextSibling());u--);n(l);break;default:s=!1}s&&r.preventDefault()},nodeLoadChildren:function(t,r){var i,o,a=t.tree,s=t.node;if(e.isFunction(r)&&(r=r()),r.url||e.isFunction(r.done)){if(a.nodeSetStatus(t,"loading"),r.url){var d=e.extend({},t.options.ajax,r);if(d.debugLazyDelay){var l=d.debugLazyDelay;e.isArray(l)&&(l=l[0]+Math.random()*(l[1]-l[0])),s.debug("nodeLoadChildren waiting debug delay "+Math.round(l)+"ms"),o=e.Deferred();var c=this;return setTimeout(function(){d.debugLazyDelay=!1,c.nodeLoadChildren(t,d).complete(function(){o.resolve.apply(this,arguments)})},l),o}o=e.ajax(d)}else o=r;o.done(function(n){a.nodeSetStatus(t,"ok"),i=n,"string"==typeof i&&e.error("Ajax request returned a string (did you get the JSON dataType wrong?).")}).fail(function(e,n,r){a.nodeSetStatus(t,"error",n,e.status+": "+r),alert("error: "+n+" ("+e.status+": "+(r.message||r)+")")})}else o=e.Deferred(),i=r,o.resolve();return o.done(function(){n(e.isArray(i),"expected array of children"),s._setChildren(i),s.parent&&(s.isVisible()&&a.nodeRender(t),a._triggerNodeEvent("loadchildren",s))}).fail(function(){a.nodeRender(t)}),o},nodeLoadKeyPath:function(){},nodeMakeVisible:function(e){for(var t=e.node.getParentList(!1,!1),n=0,r=t.length;r>n;n++)t[n].setExpanded(!0)},nodeRemoveChild:function(t,r){var i=t.node,o=i.children;if(m.debug("nodeRemoveChild()",""+i,""+r),1===o.length)return n(r===o[0]),this.nodeRemoveChildren(t);this.activeNode&&(r===this.activeNode||this.activeNode.isDescendantOf(r))&&this.activeNode.setActive(!1),this.focusNode&&(r===this.focusNode||this.focusNode.isDescendantOf(r))&&(this.focusNode=null);var a=e.extend({},t,{node:r});this.nodeRemoveMarkup(a),this.nodeRemoveChildren(a);var s=e.inArray(r,o);n(s>=0),r.visit(function(e){e.parent=null},!0),o.splice(s,1)},nodeRemoveChildMarkup:function(t){var n=t.node;m.debug("nodeRemoveChildMarkup()",""+n),n.ul&&(e(n.ul).remove(),n.visit(function(e){e.li=e.ul=null}),n.ul=null)},nodeRemoveChildren:function(e){var t=e.node,n=t.children;m.debug("nodeRemoveChildren()",""+t),n&&(this.activeNode&&this.activeNode.isDescendantOf(t)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(t)&&(this.focusNode=null),this.nodeRemoveChildMarkup(e),t.visit(function(e){e.parent=null}),t.children=void 0,this.nodeRenderStatus(e))},nodeRemoveMarkup:function(t){var n=t.node;m.debug("nodeRemoveMarkup()",""+n),n.li&&(e(n.li).remove(),n.li=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(t,r,i,o,a){var s,d,l=t.node,c=t.tree,u=t.options,h=u.aria,f=!1,p=l.parent,v=!p,g=l.children;if(n(v||p.ul,"parent UL must exist"),v||(l.li&&(r||l.li.parentNode!==l.parent.ul)&&(l.li.parentNode!==l.parent.ul&&alert("unlink "+l+" (must be child of "+l.parent+")"),this.nodeRemoveMarkup(t)),l.li||(f=!0,l.li=document.createElement("li"),l.li.ftnode=l,l.key&&u.generateIds&&(l.li.id=u.idPrefix+l.key),l.span=document.createElement("span"),l.span.className="fancytree-node",h&&e(l.span).attr("aria-labelledby","ftal_"+l.key),l.li.appendChild(l.span),this.nodeRenderTitle(t),c._triggerNodeEvent("createnode",t)),c._triggerNodeEvent("rendernode",t)),g){if(v||l.expanded||i===!0){for(l.ul||(l.ul=document.createElement("ul"),(o===!0&&!a||!l.expanded)&&(l.ul.style.display="none"),h&&e(l.ul).attr("role","group"),l.li.appendChild(l.ul)),s=0,d=g.length;d>s;s++){var y=e.extend({},t,{node:g[s]});this.nodeRender(y,r,i,!1,!0)}var m=l.ul.firstChild;for(s=0,d=g.length-1;d>s;s++){var b=g[s],x=m.ftnode;b!==x?(l.debug("_fixOrder: mismatch at index "+s+": "+b+" != "+x),l.ul.insertBefore(b.li,x.li)):m=m.nextSibling}}}else l.ul&&(alert("remove child markup for "+l),this.nodeRemoveChildMarkup(t));v||(this.nodeRenderStatus(t),f&&p.ul.appendChild(l.li))},nodeRenderTitle:function(e,t){var n,r=e.node,i=e.tree,o=e.options,a=o.aria,s=r.getLevel(),d=[];if(void 0!==t&&(r.title=t),r.span){o.minExpandLevel>s?s>1&&(a?d.push("<span role='button' class='fancytree-expander'></span>"):d.push("<span class='fancytree-expander'></span>")):a?d.push("<span role='button' class='fancytree-expander'></span>"):d.push("<span class='fancytree-expander'></span>"),o.checkbox&&r.hideCheckbox!==!0&&!r.isStatusNode&&(a?d.push("<span role='checkbox' class='fancytree-checkbox'></span>"):d.push("<span class='fancytree-checkbox'></span>"));var l=r.data.icon;if(n=a?" role='img'":"",l){var c="/"===l.charAt(0)?l:o.imagePath+l;d.push("<img src='"+c+"' alt='' />")}else r.data.iconclass?d.push("<span "+n+" class='fancytree-custom-icon"+" "+r.data.iconclass+"'></span>"):l!==!1&&d.push("<span "+n+" class='fancytree-icon'></span>");var u="";if(o.onCustomRender&&(u=o.onCustomRender.call(i,r)||""),!u){var h=r.tooltip?" title='"+r.tooltip.replace(/\"/g,"&quot;")+"'":"",f=a?" id='ftal_"+r.key+"'":"";n=a?" role='treeitem'":"",u="<span "+n+" class='fancytree-title'"+f+h+">"+r.title+"</span>"}d.push(u),r.span.innerHTML=d.join("")}},nodeRenderStatus:function(t){var n=t.node,r=t.tree,i=t.options,o=n.hasChildren(),a=n.isLastSibling(),s=i.aria,d=e(n.span).find(".fancytree-title"),l=i._classNames,c=[],u=n[r.statusClassPropName];u&&(c.push(l.node),r.activeNode===n&&c.push(l.active),r.focusNode===n?(c.push(l.focused),s&&d.attr("aria-activedescendant",!0)):s&&d.removeAttr("aria-activedescendant"),n.expanded?(c.push(l.expanded),s&&d.attr("aria-expanded",!0)):s&&d.removeAttr("aria-expanded"),n.folder&&c.push(l.folder),o!==!1&&c.push(l.hasChildren),a&&c.push(l.lastsib),n.lazy&&null===n.children&&c.push(l.lazy),n.partsel&&c.push(l.partsel),n.selected?(c.push(l.selected),s&&d.attr("aria-selected",!0)):s&&d.attr("aria-selected",!1),n.extraClasses&&c.push(n.extraClasses),o===!1?c.push(l.combinedExpanderPrefix+"n"+(a?"l":"")):c.push(l.combinedExpanderPrefix+(n.expanded?"e":"c")+(n.lazy&&null===n.children?"d":"")+(a?"l":"")),c.push(l.combinedIconPrefix+(n.expanded?"e":"c")+(n.folder?"f":"")),n[r.statusClassPropName].className=c.join(" "),n.li&&(n.li.className=a?l.lastsib:""))},nodeSetActive:function(t,r){var i=t.node,s=t.tree,d=t.options,l=i===s.activeNode;if(r=r!==!1,i.debug("nodeSetActive",r),l===r)return o(i);if(r&&this._triggerNodeEvent("beforeActivate",i,t.orgEvent)===!1)return a(i,["rejected"]);if(r){if(s.activeNode){n(s.activeNode!==i,"node was active (inconsistency)");var c=e.extend({},t,{node:s.activeNode});s.nodeSetActive(c,!1),n(null===s.activeNode,"deactivate was out of sync?")}d.activeVisible&&s.nodeMakeVisible(t),s.activeNode=i,s.nodeRenderStatus(t),s.nodeSetFocus(t),s._triggerNodeEvent("activate",i)}else n(s.activeNode===i,"node was not active (inconsistency)"),s.activeNode=null,this.nodeRenderStatus(t),t.tree._triggerNodeEvent("deactivate",i)},nodeSetExpanded:function(t,n){var r=t.node,i=t.tree,s=t.options;if(n=n!==!1,r.debug("nodeSetExpanded("+n+")"),r.expanded&&n||!r.expanded&&!n)return r.debug("nodeSetExpanded("+n+"): nothing to do"),o(r);if(n&&!r.lazy&&!r.hasChildren())return a(r,["empty"]);if(!n&&r.getLevel()<s.minExpandLevel)return a(r,["locked"]);if(this._triggerNodeEvent("beforeExpand",r,t.orgEvent)===!1)return a(r,["rejected"]);var d=new e.Deferred;if(n&&!r.expanded&&s.autoCollapse){var l=r.getParentList(!1,!0),c=s.autoCollapse;try{s.autoCollapse=!1;for(var u=0,h=l.length;h>u;u++)this._callHook("nodeCollapseSiblings",l[u])}finally{s.autoCollapse=c}}d.done(function(){t.tree._triggerNodeEvent(n?"expand":"collapse",t),s.autoScroll&&r.getLastChild().scrollIntoView(!0,r)});var f=function(){if(r.expanded=n,i._callHook("nodeRender",t,!1,!1,!0),r.ul){var o="none"!==r.ul.style.display,a=!!r.expanded;if(o===a)r.warn("nodeSetExpanded: UL.style.display already set"),d.resolveWith(r);else if(s.fx){var l=s.fx.duration||200,c=s.fx.easing;r.debug("nodeSetExpanded: animate start..."),e(r.ul).animate(s.fx,l,c,function(){r.debug("nodeSetExpanded: animate done"),d.resolveWith(r)})}else r.ul.style.display=r.expanded||!parent?"":"none",d.resolveWith(r)}else d.resolveWith(r)};return n&&r.lazy&&void 0===r.hasChildren()?(r.debug("nodeSetExpanded: load start..."),r.lazyLoad().done(function(){r.debug("nodeSetExpanded: load done"),d.notifyWith&&d.notifyWith(r,["loaded"]),f.call(i)}).fail(function(e){d.rejectWith(r,["load failed ("+e+")"])})):f(),r.debug("nodeSetExpanded: returns"),d.promise()},nodeSetFocus:function(t,n){var r=t.tree,i=t.node;if(r.focusNode){if(r.focusNode===i&&n!==!1)return;var o=e.extend({},t,{node:r.focusNode});r.focusNode=null,this._triggerNodeEvent("blur",o),this._callHook("nodeRenderStatus",o)}n!==!1&&(m.focusTree!==r&&(i.debug("nodeSetFocus: forcing container focus"),r.setFocus()),this.nodeMakeVisible(t),r.focusNode=i,this._triggerNodeEvent("focus",t),t.options.autoScroll&&i.scrollIntoView(),this._callHook("nodeRenderStatus",t))},_fixSelectionState:function(e){function t(e,t){(t&&!e.partsel||!t&&e.partsel)&&(e.partsel=!!t,e.renderStatus())}var n,r,i;if(e.selected)for(e.visit(function(e){t(e.parent,!0),e.unselectable||e.selected||(e.selected=!0,e.renderStatus())}),n=e.parent;n;){var o=!0;for(r=0,i=n.children.length;i>r;r++){var a=n.children[r];if(!a.selected&&!a.isStatusNode&&!a.unselectable){o=!1;break}}n.partsel=!0,n.selected=o,n.renderStatus(),n=n.parent}else for(t(e,!1),e.visit(function(e){t(e,!1),e.selected&&(e.selected=!1,e.renderStatus())}),n=e.parent;n;){var s=!1;for(r=0,i=n.children.length;i>r;r++)if(n.children[r].selected||n.children[r].partsel){s=!0;break}n.selected=!1,n.partsel=s,n.renderStatus(),n=n.parent}},nodeSetSelected:function(e,t){var n=e.node,r=e.tree,i=e.options;return t=t!==!1,n.debug("nodeSetSelected("+t+")"),n.selected&&t||!n.selected&&!t?!!n.selected:this._triggerNodeEvent("beforeSelect",n,e.orgEvent)===!1?!!n.selected:(t&&1===i.selectMode?r.lastSelectedNode&&r.lastSelectedNode.setSelected(!1):3===i.selectMode&&(n.selected=t,this._fixSelectionState(n)),n.selected=t,this.nodeRenderStatus(e),r.lastSelectedNode=t?n:null,r._triggerNodeEvent("select",e),void 0)},nodeSetStatus:function(t,n,r,i){var o=t.node,a=t.tree,s=function(){var e=o.children?o.children[0]:null;if(e&&e.isStatusNode){try{o.ul&&(o.ul.removeChild(e.li),e.li=null)}catch(t){}1===o.children.length?o.children=[]:o.children.shift()}},d=function(t){var n=o.children?o.children[0]:null;return n&&n.isStatusNode?(e.extend(n,t),a._callHook("nodeRender",n)):(t.key="_statusNode",o._setChildren([t]),o.children[0].isStatusNode=!0,a.render()),o.children[0]};switch(n){case"ok":s(),e(o.span).removeClass("fancytree-loading");break;case"loading":e(o.span).addClass("fancytree-loading"),o.parent||d({title:a.options.strings.loading+(r?" ("+r+") ":""),tooltip:i,extraClasses:"fancytree-statusnode-wait"});break;case"error":e(o.span).addClass("fancytree-error"),d({title:a.options.strings.loadError+" ("+r+")",tooltip:i,extraClasses:"fancytree-statusnode-error"});break;default:e.error("invalid status "+n)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){return this.nodeSetSelected(e,!e.node.selected)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null},treeCreate:function(){},treeDestroy:function(){},treeInit:function(e){this.treeLoad(e)},treeLoad:function(n,r){var i,o=n.tree,a=n.widget.element,s=e.extend({},n,{node:this.rootNode});if(o.rootNode.children&&this.treeClear(n),r=r||this.options.source)"string"==typeof r&&t();else{var d,l=a.data("type")||"html";switch(l){case"html":d=a.find(">ul:first"),d.addClass("ui-fancytree-source ui-helper-hidden"),r=e.ui.fancytree.parseHtml(d);break;case"json":r=e.parseJSON(a.text()),r.children&&(r.title&&(o.title=r.title),r=r.children);break;default:e.error("Invalid data-type: "+l)}}return i=this.nodeLoadChildren(s,r).done(function(){o.render(),o._triggerTreeEvent("init",!0)}).fail(function(){o.render(),o._triggerTreeEvent("init",!1)})},treeOnFocusInOut:function(e){var t="focusin"===e.type;this.debug("treeOnFocusInOut("+t+")",e.type,e),m.focusTree&&(this===m.focusTree&&t||(m.focusTree.focusNode&&m.focusTree.focusNode.setFocus(!1),m.focusTree.$container.removeClass("fancytree-focused"),this._triggerTreeEvent("blurtree"))),t?(m.focusTree=this,this.$container.addClass("fancytree-focused"),this.focusNode||(this.activeNode?this.activeNode.setFocus():this.rootNode.hasChildren()&&this.rootNode.getFirstChild().setFocus()),this._triggerTreeEvent("focustree")):m.focusTree=null},treeSetFocus:function(e){e.tree.$container.focus()},reactivate:function(e){var t=this.activeNode;t&&(this.activeNode=null,t.setActive(),e&&t.setFocus())},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},toDict:function(e,t){return this.rootNode.toDict(e,t)},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(e,t,n){var r=this._makeHookContext(t,n),i=this.widget._trigger(e,n,r);return i!==!1&&void 0!==r.result?r.result:i},_triggerTreeEvent:function(e,t){var n=this._makeHookContext(this,t),r=this.widget._trigger(e,t,n);return r!==!1&&void 0!==n.result?n.result:r},visit:function(e){return this.rootNode.visit(e,!1)},warn:function(){Array.prototype.unshift.call(arguments,""+this),m.warn.apply(this,arguments)}},e.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,disabled:!1,extensions:[],fx:{height:"toggle",duration:200},generateIds:!1,idPrefix:"ft_",keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!"},tabbable:!0,_classNames:{container:"fancytree-container",node:"fancytree-node",folder:"fancytree-folder",empty:"fancytree-empty",vline:"fancytree-vline",expander:"fancytree-expander",checkbox:"fancytree-checkbox",icon:"fancytree-icon",title:"fancytree-title",noConnector:"fancytree-no-connector",statusnodeError:"fancytree-statusnode-error",statusnodeWait:"fancytree-statusnode-wait",hidden:"fancytree-hidden",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",loading:"fancytree-loading",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused ui-state-focus",partsel:"fancytree-partsel",lastsib:"fancytree-lastsib"},lazyload:null},_create:function(){this.tree=new c(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");for(var t=this.options.extensions,r=this.tree,o=0;t.length>o;o++){var a=t[o],s=e.ui.fancytree._extensions[a];s||e.error("Could not apply extension '"+a+"' (it is not registered, did you forget to include it?)"),this.tree.options[a]=e.extend(!0,{},s.options,this.tree.options[a]),n(!this.tree[a],"Extension name must not exist as Fancytree attribute: "+a),this.tree[a]={},i(this.tree,r,s,a),r=s}this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(t,n){var r=!0,i=!1;switch(t){case"aria":case"checkbox":case"minExpandLevel":case"tabbable":this.tree._callHook("treeCreate",this.tree),i=!0;break;case"source":r=!1,this.tree._callHook("treeLoad",this.tree,n)}this.tree.debug("set option "+t+"="+n+" <"+typeof n+">"),r&&e.Widget.prototype._setOption.apply(this,arguments),i&&this.tree.render(!0,!1)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),this.tree.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("ui-helper-hidden"),e.Widget.prototype.destroy.call(this)},_unbind:function(){var t=this.tree._ns;this.element.unbind(t),this.tree.$container.unbind(t),e(document).unbind(t)},_bind:function(){var t=this,n=this.options,r=this.tree,i=r._ns,o=e.support.selectstart?"selectstart":"mousedown";
this._unbind(),r.debug("bind events; container: ",r.$container),r.$container.bind("focusin"+i+" focusout"+i,function(e){r.debug("Tree container got event "+e.type),r.treeOnFocusInOut(e)}).delegate("span.fancytree-title",o+i,function(e){r.debug("<span> got event "+e.type),e.preventDefault()}),e(document).bind("keydown"+i,function(e){if(r.debug("doc got event "+e.type+", hasFocus:"+r.hasFocus()),n.disabled||n.keyboard===!1||!r.hasFocus())return!0;var t=r.focusNode,i=r._makeHookContext(t||r,e),o=r.phase;try{return r.phase="userEvent",t?r._triggerNodeEvent("keydown",t,e)===!1?!1:r._callHook("nodeKeydown",i):r._triggerTreeEvent("keydown",e)===!1?!1:r._callHook("nodeKeydown",i)}finally{r.phase=o}}),this.element.bind("click"+i+" dblclick"+i,function(e){if(n.disabled)return!0;var r=m.getEventTarget(e),i=r.node;if(!i)return!0;var o=t.tree,a=o._makeHookContext(i,e),s=o.phase;try{switch(o.phase="userEvent",e.type){case"click":return a.targetType=r.type,o._triggerNodeEvent("click",a,e)===!1?!1:o._callHook("nodeClick",a);case"dblclick":return a.targetType=r.type,o._triggerNodeEvent("dblclick",a,e)===!1?!1:o._callHook("nodeDblclick",a)}}finally{o.phase=s}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(e){return this.tree.getNodeByKey(e)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}});var m=e.ui.fancytree;e.extend(e.ui.fancytree,{version:"2.0.0pre",debugLevel:2,_nextId:1,_nextNodeKey:1,_extensions:{},focusTree:null,_FancytreeClass:c,_FancytreeNodeClass:l,debug:function(){e.ui.fancytree.debugLevel>=2&&u("log",arguments)},error:function(){u("error",arguments)},getEventTargetType:function(e){return this.getEventTarget(e).type},getEventTarget:function(e){var t=e&&e.target?e.target.className:"",n={node:this.getNode(e.target),type:void 0};return"fancytree-title"===t?n.type="title":"fancytree-expander"===t?n.type=n.node.hasChildren()===!1?"prefix":"expander":"fancytree-checkbox"===t?n.type="checkbox":"fancytree-icon"===t?n.type="icon":t.indexOf("fancytree-node")>=0&&(n.type="title"),n},getNode:function(e){if(e instanceof l)return e;for(void 0!==e.selector?e=e[0]:void 0!==e.originalEvent&&(e=e.target);e;){if(e.ftnode)return e.ftnode;e=e.parentNode}return null},info:function(){e.ui.fancytree.debugLevel>=1&&u("info",arguments)},parseHtml:function(t){var n,r,i,o,a,s,d,l=t.find(">li"),c=[];return l.each(function(){var l=e(this),u=l.find(">span:first",this),h=u.length?null:l.find(">a:first"),v={tooltip:null,data:{}};for(u.length?v.title=u.html():h&&h.length?(v.title=h.html(),v.data.href=h.attr("href"),v.data.target=h.attr("target"),v.tooltip=h.attr("title")):(v.title=l.html(),o=v.title.search(/<ul/i),o>=0&&(v.title=v.title.substring(0,o))),v.title=e.trim(v.title),r=0,i=f.length;i>r;r++)v[f[r]]=void 0;for(s=this.className.split(" "),n=[],r=0,i=s.length;i>r;r++)d=s[r],p[d]?v[d]=!0:n.push(d);v.extraClasses=n.join(" "),a=l.attr("title"),a&&(v.tooltip=a),a=l.attr("id"),a&&(v.key=a);var g=l.data();if(g&&!e.isEmptyObject(g)){var y=g.json;delete g.json,e.extend(v.data,g),y&&e.extend(v.data,y)}t=l.find(">ul:first"),v.children=t.length?e.ui.fancytree.parseHtml(t):v.lazy?void 0:null,c.push(v)}),c},registerExtension:function(t,n){e.ui.fancytree._extensions[t]=n},warn:function(){u("warn",arguments)}})})(jQuery),function(e){e.ui.fancytree.registerExtension("profiler",{options:{prefix:""},nodeRender:function(e,t,n,r){var i=this.options.prefix+"render '"+e.node+"'";window.console&&window.console.time&&window.console.time(i),this._super(e,t,n,r),window.console&&window.console.timeEnd&&window.console.timeEnd(i)}})}(jQuery),function(e){"use strict";e.ui.fancytree.registerExtension("columnview",{options:{},treeInit:function(t){var n=t.tree,r=n.widget.element;n.tr=e("tbody tr",r)[0],n.columnCount=e(">td",n.tr).length,this._super(t);var i=e(n.rootNode.ul),o=e(">td",n.tr).eq(0);i.removeClass("fancytree-container"),i.removeAttr("tabindex"),n.$container=r,r.addClass("fancytree-container fancytree-ext-columnview"),r.attr("tabindex","0"),o.empty(),i.detach().appendTo(o),n.widget.options.autoCollapse=!0,n.widget.options.fx=!1,n.widget.options.clickFolderMode=1,r.bind("fancytreeactivate",function(t,n){var r,i=n.node,o=n.tree,a=i.getLevel();if(o._callHook("nodeCollapseSiblings",i),o.columnCount>=a){var s=e(">td",o.tr);for(r=a;o.columnCount>r;r++)s.eq(r).empty()}i.expanded||!i.children&&!i.lazy||i.setExpanded()}).bind("fancytreekeydown",function(t,n){var r=null;switch(t.which){case e.ui.keyCode.DOWN:return r=n.node.getNextSibling(),r&&r.setFocus(),!1;case e.ui.keyCode.LEFT:return r=n.node.getParent(),r&&r.setFocus(),!1;case e.ui.keyCode.UP:return r=n.node.getPrevSibling(),r&&r.setFocus(),!1}})},nodeRender:function(t,n,r,i,o){this._super(t,n,r,i,o);var a=t.tree,s=t.node,d=e(s.span);if(d.find("span.fancytree-expander").remove(),s.hasChildren()===!1||d.find("span.fancytree-cv-right").length||d.append(e("<span class='fancytree-icon fancytree-cv-right'>")),s.ul){s.ul.style.display="";var l=s.getLevel();if(a.columnCount>l){var c=e(">td",a.tr).eq(l),u=e(s.ul).detach();c.empty().append(u)}}}})}(jQuery),function(e){"use strict";function t(t){var r=t.options.dnd||null;r&&n(),r&&r.onDragStart&&t.widget.element.draggable({addClasses:!1,appendTo:"body",containment:!1,delay:0,distance:4,revert:!1,scroll:!0,scrollSpeed:7,scrollSensitivity:10,connectToFancytree:!0,helper:function(t){var n=e.ui.fancytree.getNode(t.target);return n?n.tree.dnd._onDragEvent("helper",n,null,t,null,null):"<div>ERROR?: helper requested but sourceNode not found</div>"},start:function(){},_last:null}),r&&r.onDrop&&t.widget.element.droppable({addClasses:!1,tolerance:"intersect",greedy:!1,_last:null})}function n(){i||(e.ui.plugin.add("draggable","connectToFancytree",{start:function(t,n){var r=e(this).data("ui-draggable")||e(this).data("draggable"),i=n.helper.data("ftSourceNode")||null;return i?(r.offset.click.top=-2,r.offset.click.left=16,i.tree.dnd._onDragEvent("start",i,null,t,n,r)):void 0},drag:function(t,n){var i=e(this).data("ui-draggable")||e(this).data("draggable"),o=n.helper.data("ftSourceNode")||null,a=n.helper.data("ftTargetNode")||null,s=e.ui.fancytree.getNode(t.target);if(t.target&&!s){var d=e(t.target).closest("div.fancytree-drag-helper,#fancytree-drop-marker").length>0;if(d)return r("Drag event over helper: ignored."),void 0}n.helper.data("ftTargetNode",s),a&&a!==s&&a.tree.dnd._onDragEvent("leave",a,o,t,n,i),s&&s.tree.options.dnd.onDrop&&(s===a?s.tree.dnd._onDragEvent("over",s,o,t,n,i):s.tree.dnd._onDragEvent("enter",s,o,t,n,i))},stop:function(t,n){var i=e(this).data("ui-draggable")||e(this).data("draggable"),o=n.helper.data("ftSourceNode")||null,a=n.helper.data("ftTargetNode")||null,s=t.type,d="mouseup"===s&&1===t.which;d||r("Drag was cancelled"),a&&(d&&a.tree.dnd._onDragEvent("drop",a,o,t,n,i),a.tree.dnd._onDragEvent("leave",a,o,t,n,i)),o&&o.tree.dnd._onDragEvent("stop",o,null,t,n,i)}}),i=!0)}var r=e.ui.fancytree.debug,i=!1;e.ui.fancytree.registerExtension("dnd",{options:{onDragStart:null,onDragStop:null,autoExpandMS:1e3,preventVoidMoves:!0,preventRecursiveMoves:!0,onDragEnter:null,onDragOver:null,onDrop:null,onDragLeave:null},treeInit:function(e){var n=e.tree;this._super(e),t(n)},nodeKeydown:function(t){var n=t.orgEvent;n.which===e.ui.keyCode.ESCAPE&&this.dnd._cancelDrag(),this._super(t)},_setDndStatus:function(t,n,r,i,o){var a=this.dnd,s=t?e(t.span):null,d=e(n.span);if(a.$dropMarker||(a.$dropMarker=e("<div id='fancytree-drop-marker'></div>").hide().css({"z-index":1e3}).prependTo(e(this.$div).parent())),"after"===i||"before"===i||"over"===i){var l="0 0";switch(i){case"before":a.$dropMarker.removeClass("fancytree-drop-after fancytree-drop-over"),a.$dropMarker.addClass("fancytree-drop-before"),l="0 -8";break;case"after":a.$dropMarker.removeClass("fancytree-drop-before fancytree-drop-over"),a.$dropMarker.addClass("fancytree-drop-after"),l="0 8";break;default:a.$dropMarker.removeClass("fancytree-drop-after fancytree-drop-before"),a.$dropMarker.addClass("fancytree-drop-over"),d.addClass("fancytree-drop-target"),l="8 0"}a.$dropMarker.show().position({my:"left top",at:"left top",of:d,offset:l})}else d.removeClass("fancytree-drop-target"),a.$dropMarker.hide();"after"===i?d.addClass("fancytree-drop-after"):d.removeClass("fancytree-drop-after"),"before"===i?d.addClass("fancytree-drop-before"):d.removeClass("fancytree-drop-before"),o===!0?(s&&s.addClass("fancytree-drop-accept"),d.addClass("fancytree-drop-accept"),r.addClass("fancytree-drop-accept")):(s&&s.removeClass("fancytree-drop-accept"),d.removeClass("fancytree-drop-accept"),r.removeClass("fancytree-drop-accept")),o===!1?(s&&s.addClass("fancytree-drop-reject"),d.addClass("fancytree-drop-reject"),r.addClass("fancytree-drop-reject")):(s&&s.removeClass("fancytree-drop-reject"),d.removeClass("fancytree-drop-reject"),r.removeClass("fancytree-drop-reject"))},_onDragEvent:function(t,n,i,o,a,s){"over"!==t&&r("tree.dnd._onDragEvent(%s, %o, %o) - %o",t,n,i,this);var d,l=this.options,c=l.dnd,u=null,h=e(n.span);switch(t){case"helper":var f=e("<div class='fancytree-drag-helper'><span class='fancytree-drag-helper-img' /></div>").append(e(o.target).closest("span.fancytree-title").clone());e("ul.fancytree-container",n.tree.$div).append(f),f.data("ftSourceNode",n),r("helper=%o",f),r("helper.sourceNode=%o",f.data("ftSourceNode")),u=f;break;case"start":n.isStatusNode?u=!1:c.onDragStart&&(u=c.onDragStart(n)),u===!1?(this.debug("tree.onDragStart() cancelled"),a.helper.trigger("mouseup"),a.helper.hide()):h.addClass("fancytree-drag-source");break;case"enter":u=c.preventRecursiveMoves&&n.isDescendantOf(i)?!1:c.onDragEnter?c.onDragEnter(n,i):null,u=u?{over:u===!0||"over"===u||e.inArray("over",u)>=0,before:u===!0||"before"===u||e.inArray("before",u)>=0,after:u===!0||"after"===u||e.inArray("after",u)>=0}:!1,a.helper.data("enterResponse",u),r("helper.enterResponse: %o",u);break;case"over":var p=a.helper.data("enterResponse");if(d=null,p===!1);else if("string"==typeof p)d=p;else{var v=h.offset(),g={x:o.pageX-v.left,y:o.pageY-v.top},y={x:g.x/h.width(),y:g.y/h.height()};p.after&&y.y>.75?d="after":!p.over&&p.after&&y.y>.5?d="after":p.before&&.25>=y.y?d="before":!p.over&&p.before&&.5>=y.y?d="before":p.over&&(d="over"),c.preventVoidMoves&&(n===i?(r("    drop over source node prevented"),d=null):"before"===d&&i&&n===i.getNextSibling()?(r("    drop after source node prevented"),d=null):"after"===d&&i&&n===i.getPrevSibling()?(r("    drop before source node prevented"),d=null):"over"===d&&i&&i.parent===n&&i.isLastSibling()&&(r("    drop last child over own parent prevented"),d=null)),a.helper.data("hitMode",d)}"over"===d&&c.autoExpandMS&&n.hasChildren()!==!1&&!n.expanded&&n.scheduleAction("expand",c.autoExpandMS),d&&c.onDragOver&&(u=c.onDragOver(n,i,d)),this.dnd._setDndStatus(i,n,a.helper,d,u!==!1&&null!==d);break;case"drop":d=a.helper.data("hitMode"),d&&c.onDrop&&c.onDrop(n,i,d,a,s);break;case"leave":n.scheduleAction("cancel"),a.helper.data("enterResponse",null),a.helper.data("hitMode",null),this.dnd._setDndStatus(i,n,a.helper,"out",void 0),c.onDragLeave&&c.onDragLeave(n,i);break;case"stop":h.removeClass("fancytree-drag-source"),c.onDragStop&&c.onDragStop(n);break;default:throw"Unsupported drag event: "+t}return u},_cancelDrag:function(){var t=e.ui.ddmanager.current;t&&t.cancel()}})}(jQuery),function(e){"use strict";function t(e){return(e+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")}e.ui.fancytree._FancytreeClass.prototype.applyFilter=function(e){var n=0;if(this.visit(function(e){delete e.match,delete e.subMatch}),"string"==typeof e){var r=t(e),i=RegExp(".*"+r+".*","i");e=function(e){return!!i.exec(e.title)}}return this.enableFilter=!0,this.$div.addClass("fancytree-ext-filter"),this.visit(function(t){e(t)&&(n++,t.match=!0,t.visitParents(function(e){e.subMatch=!0}))}),this.render(),n},e.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){this.visit(function(t){delete t.match,delete t.subMatch,e(t.li).show()}),this.enableFilter=!1,this.render(),this.$div.removeClass("fancytree-ext-filter")},e.ui.fancytree.registerExtension("filter",{options:{mode:"dimm"},treeInit:function(e){this._super(e),e.tree.filter=!1},treeDestroy:function(e){this._super(e)},nodeRenderStatus:function(t){var n=t.node,r=t.options,i=t.tree,o=e(n[i.statusClassPropName]);if(o.length&&(this._super(t),i.enableFilter&&(n.match?o.addClass("fancytree-match"):o.removeClass("fancytree-match"),n.subMatch?o.addClass("fancytree-submatch"):o.removeClass("fancytree-submatch"),"hide"===r.filter.mode))){var a=!(!n.match&&!n.subMatch);n.debug(n.title+": visible="+a),e(n.li).toggle(a)}}})}(jQuery),function(e){"use strict";e.ui.fancytree.registerExtension("menu",{version:"1.0.0pre",options:{enable:!0,selector:null,position:{},create:e.noop,beforeOpen:e.noop,open:e.noop,focus:e.noop,select:e.noop,close:e.noop},treeInit:function(t){var n=t.options,r=t.tree;this._super(t),r.menu.data={tree:r,node:null,$menu:null,menuId:null},r.$container.delegate("span.fancytree-node","contextmenu",function(t){var n=e.ui.fancytree.getNode(t),i={node:n,tree:n.tree,orgEvent:t,options:r.options};return r.menu._openMenu(i),!1}),e(n.menu.selector).menu({create:function(t){r.menu.data.$menu=e(this).menu("widget");var i=e.extend({},r.menu.data);n.menu.create.call(r,t,i)},focus:function(t,i){var o=e.extend({},r.menu.data,{menuItem:i.item,menuId:i.item.find(">a").attr("href")});n.menu.focus.call(r,t,o)},select:function(i,o){var a=e.extend({},r.menu.data,{menuItem:o.item,menuId:o.item.find(">a").attr("href")});n.menu.select.call(r,i,a)!==!1&&r.menu._closeMenu(t)}}).hide()},treeDestroy:function(e){this._super(e)},_openMenu:function(t){var n=t.tree,r=t.options,i=e(r.menu.selector);n.menu.data.node=t.node;var o=e.extend({},n.menu.data);r.menu.beforeOpen.call(n,t.orgEvent,o)!==!1&&(e(document).bind("keydown.fancytree",function(r){r.which===e.ui.keyCode.ESCAPE&&n.menu._closeMenu(t)}).bind("mousedown.fancytree",function(r){0===e(r.target).closest(".ui-menu-item").length&&n.menu._closeMenu(t)}),i.css("position","absolute").show().position({my:"left top",at:"right top",of:t.orgEvent,collision:"fit"}).focus(),r.menu.open.call(n,t.orgEvent,o))},_closeMenu:function(t){var n=t.tree,r=t.options,i=e.extend({},n.menu.data);if(r.menu.close.call(n,t.orgEvent,i)!==!1){var o=e(r.menu.selector);e(document).unbind("keydown.fancytree, mousedown.fancytree"),o.hide(),n.menu.data.node=null}}})}(jQuery),function(e){"use strict";function t(t,n){n=n||"",t||e.error("Assertion failed "+n)}var n="active",r="expanded",i="focus",o="selected";e.ui.fancytree._FancytreeClass.prototype.clearCookies=function(t){var a=this.persist.cookiePrefix;t=t||"active expanded focus selected",t.indexOf(n)>=0&&e.cookie(a+n,null),t.indexOf(r)>=0&&e.cookie(a+r,null),t.indexOf(i)>=0&&e.cookie(a+i,null),t.indexOf(o)>=0&&e.cookie(a+o,null)},e.ui.fancytree.registerExtension("persist",{options:{cookieDelimiter:"~",cookiePrefix:void 0,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},overrideSource:!1,types:"active expanded focus selected"},_setKey:function(t,n,r){var i=this.persist,o=this.options.persist,a=i.cookiePrefix+t,s=e.cookie(a),d=s?s.split(o.cookieDelimiter):[],l=e.inArray(n,d);l>=0&&d.splice(l,1),r&&d.push(n),e.cookie(a,d.join(o.cookieDelimiter),o.cookie)},treeInit:function(a){var s=a.tree,d=a.options,l=this.persist,c=this.options.persist;t(e.cookie,"Missing required plugin for 'persist' extension: jquery.cookie.js"),l.cookiePrefix=c.cookiePrefix||"fancytree-"+s._id+"-",l.storeActive=c.types.indexOf(n)>=0,l.storeExpanded=c.types.indexOf(r)>=0,l.storeSelected=c.types.indexOf(o)>=0,l.storeFocus=c.types.indexOf(i)>=0,s.$div.bind("fancytreeinit",function(){var t,a,u,h,f=e.cookie(l.cookiePrefix+i);if(s.debug("COOKIE "+document.cookie),l.storeExpanded&&(t=e.cookie(l.cookiePrefix+r)))for(a=t.split(c.cookieDelimiter),u=0;a.length>u;u++)h=s.getNodeByKey(a[u]),h?(void 0===h.expanded||c.overrideSource&&h.expanded===!1)&&(h.expanded=!0,h.render()):l._setKey(r,a[u],!1);if(l.storeSelected&&(t=e.cookie(l.cookiePrefix+o)))for(a=t.split(c.cookieDelimiter),u=0;a.length>u;u++)h=s.getNodeByKey(a[u]),h?(void 0===h.selected||c.overrideSource&&h.selected===!1)&&(h.selected=!0,h.renderStatus()):l._setKey(o,a[u],!1);l.storeActive&&(t=e.cookie(l.cookiePrefix+n),!t||!d.persist.overrideSource&&s.activeNode||(h=s.getNodeByKey(t),h&&h.setActive())),l.storeFocus&&f&&(h=s.getNodeByKey(f),h&&h.setFocus())}),this._super(a)},nodeSetActive:function(t,r){var i=this.persist,o=this.options.persist;this._super(t,r),i.storeActive&&e.cookie(i.cookiePrefix+n,this.activeNode?this.activeNode.key:null,o.cookie)},nodeSetExpanded:function(e,t){var n=e.node,i=this.persist;this._super(e,t),i.storeExpanded&&i._setKey(r,n.key,t)},nodeSetFocus:function(t){var n=this.persist,r=this.options.persist;this._super(t),n.storeFocus&&e.cookie(this.cookiePrefix+i,this.focusNode?this.focusNode.key:null,r.cookie)},nodeSetSelected:function(e,t){var n=e.node,r=this.persist;this._super(e,t),r.storeSelected&&r._setKey(o,n.key,t)}})}(jQuery),function(e){"use strict";function t(t,n){n=n||"",t||e.error("Assertion failed "+n)}function n(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function r(e,t){e.visit(function(e){var n=e.tr;return n&&(n.style.display=t?"":"none"),e.expanded?void 0:"skip"})}function i(n){var r,i,o=n.parent,a=o?o.children:null;if(a&&a.length>1&&a[0]!==n)for(i=e.inArray(n,a),r=a[i-1],t(r.tr);r.children;){var s=r.children[r.children.length-1];if(!s.tr)break;r=s}else r=o;return r}e.ui.fancytree.registerExtension("table",{options:{indentation:16,nodeColumnIdx:0},treeInit:function(t){var n=t.tree,r=n.widget.element;r.addClass("fancytree-container fancytree-ext-table"),n.tbody=r.find("> tbody")[0],n.columnCount=e("thead >tr >th",r).length,e(n.tbody).empty(),n.rowFragment=document.createDocumentFragment();var i=e("<tr>"),o="";t.options.aria&&(i.attr("role","row"),o=" role='gridcell'");for(var a=0;n.columnCount>a;a++)t.options.table.nodeColumnIdx===a?i.append("<td"+o+"><span class='fancytree-node'></span></td>"):i.append("<td"+o+">");n.rowFragment.appendChild(i.get(0)),this._super(t),e(n.rootNode.ul).remove(),n.rootNode.ul=null,n.$container=r,n.$container.attr("tabindex","0"),this.options.aria&&(n.$container.attr("role","treegrid"),n.$container.attr("aria-readonly",!0)),n.statusClassPropName="tr",n.ariaPropName="tr"},nodeRemoveChildMarkup:function(t){var n=t.node;n.visit(function(t){t.tr&&(e(t.tr).remove(),t.tr=null)})},nodeRemoveMarkup:function(t){var n=t.node;n.tr&&(e(n.tr).remove(),n.tr=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(r,o,a,s,d){var l=r.tree,c=r.node,u=r.options,h=!c.parent;if(d||(r.hasCollapsedParents=c.parent&&!c.parent.expanded),!h&&!c.tr){var f=l.rowFragment.firstChild.cloneNode(!0),p=i(c);t(p),s===!0&&d?f.style.display="none":a&&r.hasCollapsedParents&&(f.style.display="none"),p.tr?n(p.tr,f):(t(!p.parent,"prev. row must have a tr, or is system root"),l.tbody.appendChild(f)),c.tr=f,c.key&&u.generateIds&&(c.tr.id=u.idPrefix+c.key),c.tr.ftnode=c,u.aria&&e(c.tr).attr("aria-labelledby","ftal_"+c.key),c.span=e("span.fancytree-node",c.tr).get(0),this.nodeRenderTitle(r),l._triggerNodeEvent("createnode",r)}l._triggerNodeEvent("rendernode",r);var v,g,y=c.children;if(y&&(h||a||c.expanded))for(v=0,g=y.length;g>v;v++){var m=e.extend({},r,{node:y[v]});m.hasCollapsedParents=m.hasCollapsedParents||!c.expanded,this.nodeRender(m,o,a,s,!0)}if(y&&!d){var b=c.tr||null,x=l.tbody.firstChild;c.visit(function(e){if(e.tr){if(c.expanded||h||"none"===e.tr.style.display||(e.tr.style.display="none"),e.tr.previousSibling!==b){c.debug("_fixOrder: mismatch at node: "+e);var t=b?b.nextSibling:x;l.tbody.insertBefore(e.tr,t)}b=e.tr}})}h||this.nodeRenderStatus(r)},nodeRenderTitle:function(e){var t=e.node;this._super(e),e.tree._triggerNodeEvent("rendercolumns",t)},nodeRenderStatus:function(t){var n=t.node,r=t.options;this._super(t);var i=(n.getLevel()-1)*r.table.indentation;i&&e(n.span).css({marginLeft:i+"px"})},nodeSetExpanded:function(t,n){var i=t.node,o=new e.Deferred;return this._super(t,n).done(function(){n=n!==!1,r(t.node,n),o.resolveWith(i)}),o},nodeSetStatus:function(t,n,r,i){if("ok"===n){var o=t.node,a=o.children?o.children[0]:null;a&&a.isStatusNode&&e(a.tr).remove()}this._super(t,n,r,i)}})}(jQuery),function(e){"use strict";e.ui.fancytree.registerExtension("themeroller",{options:{activeClass:"ui-state-active",foccusClass:"ui-state-focus",hoverClass:"ui-state-hover",selectedClass:"ui-state-highlight"},treeInit:function(t){this._super(t);var n=t.widget.element;"TABLE"===n[0].nodeName?(n.addClass("ui-widget ui-corner-all"),n.find(">thead tr").addClass("ui-widget-header"),n.find(">tbody").addClass("ui-widget-conent")):n.addClass("ui-widget ui-widget-content ui-corner-all"),n.delegate(".fancytree-node","mouseenter mouseleave",function(t){var n=e.ui.fancytree.getNode(t.target),r="mouseenter"===t.type;n.debug("hover: "+r),e(n.span).toggleClass("ui-state-hover ui-corner-all",r)})},treeDestroy:function(e){this._super(e),e.widget.element.removeClass("ui-widget ui-widget-content ui-corner-all")},nodeRenderStatus:function(t){var n=t.node,r=e(n.span);this._super(t),r.toggleClass("ui-state-active",n.isActive()),r.toggleClass("ui-state-focus",n.hasFocus()),r.toggleClass("ui-state-highlight",n.isSelected())}})}(jQuery),function(e){"use strict";var t,n="nodeClick nodeCollapseSiblings".split(" "),r="activate beforeActivate".split(" "),i={},o={};for(t=0;n.length>t;t++)i[n[t]]=!0;for(t=0;r.length>t;t++)o[r[t]]=!0;e.ui.fancytree.registerExtension("tracecalls",{options:{logTarget:null,traceEvents:!1,traceHooks:!1},treeInit:function(e){var t=e.tree;t.$div.bind("fancytreeinit",function(){t.debug("COOKIE "+document.cookie)}),this._super(e)},nodeClick:function(){this.options.tracecalls.traceHooks&&this.debug()},nodeCollapseSiblings:function(){},nodeDblclick:function(){},nodeKeydown:function(){},nodeLoadChildren:function(){},nodeMakeVisible:function(){},nodeOnFocusInOut:function(){},nodeRemoveChildMarkup:function(){},nodeRemoveMarkup:function(){},nodeRender:function(){},nodeRenderStatus:function(){},nodeRenderTitle:function(){},nodeSetActive:function(){},nodeSetExpanded:function(){},nodeSetFocus:function(){},nodeSetSelected:function(){},nodeSetStatus:function(){},nodeToggleExpanded:function(){},nodeToggleSelected:function(){},treeClear:function(){},treeCreate:function(){},treeDestroy:function(){},treeLoad:function(){},treeSetFocus:function(){}})}(jQuery);